################################################################################
# Assembler/Linker Parser Rules
################################################################################

## -- Scanner Starting State -- ##
_SUB_START:
	# Parse instructions with RRR/RRI focus (no flags).
	TOKEN_AND		_SUB_START	_op3	TOKEN_REGISTER	TOKEN_REGISTER
	TOKEN_ORR		_SUB_START	_op3	TOKEN_REGISTER	TOKEN_REGISTER
	TOKEN_XOR		_SUB_START	_op3	TOKEN_REGISTER	TOKEN_REGISTER
	TOKEN_ADD		_SUB_START	_op3	TOKEN_REGISTER	TOKEN_REGISTER
	TOKEN_SUB		_SUB_START	_op3	TOKEN_REGISTER	TOKEN_REGISTER
	
	# Parse SHL/SHR instructions (special RRR/RRI cases).
	TOKEN_SHL		_SUB_START  _op3sh	TOKEN_REGISTER	TOKEN_REGISTER
	TOKEN_SHR		_SUB_START	_op3sh	TOKEN_REGISTER	_flgReg

	# Parse longer immediate instructions.
	TOKEN_LBI		_SUB_START	ACTION_INSTR_RI8	TOKEN_IMMEDIATE	_flgReg
	TOKEN_BRC		_SUB_START	ACTION_INSTR_I8	_flgImm
	
	# Parse "Memory Access" instruction/formats.
	TOKEN_LDR		_SUB_START	ACTION_INSTR_RRI6	TOKEN_IMMEDIATE	TOKEN_REGISTER	TOKEN_REGISTER
	TOKEN_STR		_SUB_START	ACTION_INSTR_RRI6	TOKEN_IMMEDIATE	TOKEN_REGISTER	TOKEN_REGISTER
	TOKEN_SWP		_SUB_START	ACTION_INSTR_RRI6	TOKEN_IMMEDIATE	TOKEN_REGISTER	TOKEN_REGISTER
	
	# Parse Jump instructions.
	TOKEN_JPR		_SUB_START	ACTION_INSTR_RI5	TOKEN_IMMEDIATE	TOKEN_REGISTER
	TOKEN_JLR		_SUB_START	ACTION_INSTR_RRI5	TOKEN_IMMEDIATE	TOKEN_REGISTER	TOKEN_REGISTER
	
	# Parse Command instructions.
	TOKEN_NOP		_SUB_START	ACTION_INSTR_CMD
	TOKEN_HLT		_SUB_START	ACTION_INSTR_CMD
	
	# Parse Macros.
	TOKEN_LD		_SUB_START	ACTION_MACRO_LD	TOKEN_LABEL	TOKEN_REGISTER
	TOKEN_ST		_SUB_START	ACTION_MACRO_ST	TOKEN_LABEL	TOKEN_REGISTER
	TOKEN_DS		_SUB_START	ACTION_MACRO_DS	TOKEN_REGISTER
	TOKEN_TO		_SUB_START	ACTION_MACRO_TO	_regLbl
	
	# Parse directives.
	TOKEN_WORD		_SUB_START	ACTION_WORD	TOKEN_IMMEDIATE
	TOKEN_ARRY		_SUB_START	ACTION_ARRY	_arrType
	TOKEN_ADDR		_SUB_START	ACTION_ADDR	TOKEN_IMMEDIATE
	
	# Parse Label Declarations.
	TOKEN_LABEL		_SUB_START	ACTION_LABEL_DECL	TOKEN_COLON
	
	# File should end with no outstanding lines.
	TOKEN_EOF
	END

## -- 3rd operand options (special and typical) -- ##
_op3:
	TOKEN_REGISTER	ACTION_INSTR_RRR
	TOKEN_IMMEDIATE	ACTION_INSTR_RRI5
	END

_op3sh:
	TOKEN_REGISTER	ACTION_INSTR_RRR
	TOKEN_IMMEDIATE	ACTION_INSTR_RRI4
	END

## -- Optional Operand Sub-States -- ##
_flgReg:
	TOKEN_FLAG		TOKEN_REGISTER
	TOKEN_REGISTER
	END

_flgImm:
	TOKEN_FLAG		TOKEN_IMMEDIATE
	TOKEN_IMMEDIATE
	END

_regLbl:
	TOKEN_REGISTER	TOKEN_LABEL
	TOKEN_LABEL
	END

## -- Array related Sub-States -- ##
_arrType:
	TOKEN_STRING
	TOKEN_IMMEDIATE
	END